@model IEnumerable<WORKFLOW_APP.Models.FIRMS_ABSENCES_PERSONS>

@{
    
    ViewBag.Title = "Create_Officers";
}
@*<script src="~/App_Start/global.js"></script>
<script src="~/Scripts/APP_SCRIPTS/Get_Clinic_Officers.js"></script>*@
<script type="text/javascript">

    bld_off_all_grd();
    BuildDropDwonlist('RANK_CAT_ID', 'RANK_CAT_ID', 'NAME','Talab_Clinic_Sh/RANK_CAT_ID_fun');
    bnd_off_all_grd(firms, 1)
    $('#RANK_CAT_ID').on('select', function (event) {
        var item = args.item;
        // get item's label and value.
        var label = item.label;
        var value = item.value;
        bld_off_all_grd();
        bnd_off_all_grd(firms, value)
        // $('#').attr('disabled', true)

    });
    $('#off_grid').on('rowdoubleclick', function (event) {
        //var data = $('#off_grid').jqxGrid('getrowdata', event.args.rowindex);
        //get_off(data);
      debugger
        var rowindex = $("#off_grid").jqxGrid("getselectedrowindex");
        var rowdata = $("#off_grid").jqxGrid("getrowdata", rowindex);
     
         PERSON_CODE = rowdata.PERSON_CODE;
         RANK_CAT_ID = rowdata.RANK_CAT_ID;
         person_rank_cat = rowdata.PERSON_CAT_ID;
         from_date = $('#TalabData').val();
         FromTime = $("#TalabTimeFrom").val();
         ToTime = $("#TalabTimeTo").val();

        // get hours_from(Int)
         var spl = FromTime.split(":");
         var hours_f = parseInt(spl[0]);
        // get hours_To(Int)
         var spl2 = ToTime.split(":");
         var hours_t = parseInt(spl2[0]);

         FullDateFrom = from_date + " " + FromTime
         FullDateTo = from_date + " " + ToTime
       
         if (hours_f >= hours_t) {
             swal({
                 title: "خطأ ",
                 text: "التوقيت غير صحيح",
                 type: "error",

                 timer: 2500
             });
             get_person_data();

         } else {
             $.ajax({
                 url: "Talab_Clinic_Sh/add_rec",
                 data: JSON.stringify({
                     PERSON_CODE: PERSON_CODE,
                     firms: firms,
                     fin_year: fin_year,
                     period_id: period_id,
                     RANK_CAT_ID: RANK_CAT_ID,
                     person_rank_cat: person_rank_cat,
                     ABSENCE_TYPE_ID: ABSENCE_TYPE_ID,
                     FullDateFrom: FullDateFrom,
                     FullDateTo: FullDateTo

                 }),
                 cache: false,
                 async: false,
                 contentType: "application/json; charset=utf-8",
                 dataType: "json",
                 type: "POST",
                 success: function (data) {
                     
                     if (data == 1) {
                         swal({
                             title: "تم الإضافة",
                             text: "تم  إضافة الطلب بنجاح",
                             type: "success",
                             timer: 2500

                         });
                         bindClinicGrid($('#TalabData').val(), firms);
                         get_person_data();

                     } else if ((data == 2)) {
                         swal({
                             title: "خطأ ",
                             text: "الظابط لديه تمام فى نفس التوقيت",
                             type: "error",

                             timer: 2500

                         });

                     } else {

                         swal({
                             title: "خطأ فى التاريخ",
                             text: "التاريخ الذي ادخلتة اقل من تاريخ اليوم",
                             type: "error",

                             timer: 2500

                         });
                     }
                 },
                 error: function (response) {
                     swal({
                         title: "خطاء",
                         text: "الطلب موجود بالفعل",
                         type: "error",
                         timer: 1500

                     });
                 }
             });
         }
    });

</script>

<div class="animated  zoomInDown">

   <div class="row">

     <div class="col-lg-4">       
         <div class="editor-label" ></div>
     </div>

     <div class="col-lg-2">
          <label>الفئة</label>
     </div>

     <div class="col-lg-4">
          <div id="RANK_CAT_ID"></div>
     </div>

   <div class="col-lg-2"></div>

    </div>
      
    <div class="row">

        <div class="col-lg-12">
           <div id="off_grid"></div>
        </div>

    </div>

  </div>